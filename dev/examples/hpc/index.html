<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>High Performance Computing · UncertaintyQuantification.jl</title><meta name="title" content="High Performance Computing · UncertaintyQuantification.jl"/><meta property="og:title" content="High Performance Computing · UncertaintyQuantification.jl"/><meta property="twitter:title" content="High Performance Computing · UncertaintyQuantification.jl"/><meta name="description" content="Documentation for UncertaintyQuantification.jl."/><meta property="og:description" content="Documentation for UncertaintyQuantification.jl."/><meta property="twitter:description" content="Documentation for UncertaintyQuantification.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">UncertaintyQuantification.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/introduction/">Introduction</a></li><li><a class="tocitem" href="../../manual/gettingstarted/">Getting Started</a></li><li><a class="tocitem" href="../../manual/reliability/">Reliability Analysis</a></li><li><a class="tocitem" href="../../manual/metamodels/">Metamodelling</a></li><li><a class="tocitem" href="../../manual/bayesianupdating/">Bayesian Updating</a></li><li><a class="tocitem" href="../../manual/parallelisation/">Parallelisation</a></li><li><a class="tocitem" href="../../manual/hpc/">High Performance Computing</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../external/">External Models</a></li><li><a class="tocitem" href="../metamodels/">Metamodels</a></li><li><a class="tocitem" href="../bayesianupdating/">Bayesian Updating</a></li><li class="is-active"><a class="tocitem" href>High Performance Computing</a><ul class="internal"><li><a class="tocitem" href="#OpenMC-TBR-uncertainty"><span>OpenMC TBR uncertainty</span></a></li></ul></li></ul></li><li><span class="tocitem">Benchmarks</span><ul><li><a class="tocitem" href="../../benchmarks/subset/">Subset Simulation</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/inputs/">Inputs</a></li><li><a class="tocitem" href="../../api/models/">Models</a></li><li><a class="tocitem" href="../../api/responsesurface/">ResponseSurface</a></li><li><a class="tocitem" href="../../api/polyharmonicspline/">PolyharmonicSpline</a></li><li><a class="tocitem" href="../../api/simulations/">Simulations</a></li><li><a class="tocitem" href="../../api/bayesianupdating/">Bayesian Updating</a></li><li><a class="tocitem" href="../../api/slurm/">SlurmInterface</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>High Performance Computing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>High Performance Computing</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/FriesischScott/UncertaintyQuantification.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/FriesischScott/UncertaintyQuantification.jl/blob/master/docs/src/examples/hpc.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="High-Performance-Computing"><a class="docs-heading-anchor" href="#High-Performance-Computing">High Performance Computing</a><a id="High-Performance-Computing-1"></a><a class="docs-heading-anchor-permalink" href="#High-Performance-Computing" title="Permalink"></a></h1><h2 id="OpenMC-TBR-uncertainty"><a class="docs-heading-anchor" href="#OpenMC-TBR-uncertainty">OpenMC TBR uncertainty</a><a id="OpenMC-TBR-uncertainty-1"></a><a class="docs-heading-anchor-permalink" href="#OpenMC-TBR-uncertainty" title="Permalink"></a></h2><p>In this example, we will run <a href="https://openmc.org/">OpenMC</a>, to compute the tritium breeding ratio (TBR) uncertainty, by varying material and geometric properties. This example was taken from the <a href="https://github.com/fusion-energy/neutronics-workshop">Fusion Neutronics Workshop</a>.</p><p>At first we need to create an array of random variables, that will be used when evaluating the points that our design produces.It will also define the range of the function we want the design to fit. This is also a good time to declare the function that we are working with.</p><p>Here we will vary the model&#39;s Li6 enrichment, and the radius of the tungsten layer.</p><pre><code class="language-julia hljs">using UncertaintyQuantification

E = RandomVariable(Uniform(0.3, 0.7), :E)
R1 = RandomVariable(Uniform(8, 14), :R1)</code></pre><p>Source/Extra files are expected to be in this folder.</p><pre><code class="language-julia hljs">sourcedir = joinpath(pwd(), &quot;demo/models&quot;)</code></pre><p>These files will be rendered through Mustache.jl and have values injected.</p><pre><code class="language-julia hljs">sourcefile = &quot;openmc_TBR.py&quot;</code></pre><p>Dictionary to map format Strings (Format.jl) to variables.</p><pre><code class="language-julia hljs">numberformats = Dict(:E =&gt; &quot;.8e&quot;)</code></pre><p>UQ will create subfolders in here to run the solver and store the results.</p><pre><code class="language-julia hljs">workdir = joinpath(pwd(), &quot;openmc_TBR&quot;)</code></pre><blockquote><p><strong>Note</strong></p><p>If Slurm is to run the jobs on multiple nodes, all the above folders must be shared by the computing nodes.</p></blockquote><p>Read output file and compute the Tritium breeding ratio. An extractor is based the working directory for the current sample.</p><pre><code class="language-julia hljs">TBR = Extractor(base -&gt; begin
    file = joinpath(base, &quot;openmc.out&quot;)
    line = readline(file)
    tbr = parse(Float64, split(line, &quot; &quot;)[1])

    return tbr
end, :TBR)</code></pre><p>In this example, an OpenMC model is built and run using the Python API. We therefore specify the <code>python3</code>` command, and the python file to run.</p><pre><code class="language-julia hljs">openmc = Solver(
    &quot;python3&quot;, # path to python3 binary
    &quot;openmc_TBR.py&quot;;
    args=&quot;&quot;, # (optional) extra arguments passed to the solver
)</code></pre><p>slurm  sbatch options</p><pre><code class="language-julia hljs">options = Dict(
    &quot;job-name&quot; =&gt; &quot;UQ_slurm&quot;,
    &quot;account&quot; =&gt; &quot;EXAMPLE-0001-CPU&quot;,
    &quot;partition&quot; =&gt; &quot;cpu_partition&quot;,
    &quot;nodes&quot; =&gt; &quot;1&quot;,
    &quot;ntasks&quot; =&gt; &quot;1&quot;,
    &quot;time&quot; =&gt; &quot;00:05:00&quot;,
)</code></pre><p>Slurm interface, passing required machine information. Note in <code>extras</code>, we specify the commands we require to run the model (for example, loading modulefiles or data).</p><pre><code class="language-julia hljs">slurm = SlurmInterface(
    options;
    throttle=50,
    extras=[&quot;module load openmc&quot;, &quot;source ~/.virtualenvs/openmc/bin/activate&quot;],
)</code></pre><p>With the <code>SlurmInterface</code> defined we can assemble the <code>ExternalModel</code>.</p><pre><code class="language-julia hljs">ext = ExternalModel(
    sourcedir,
    sourcefile,
    TBR,
    openmc;
    workdir=workdir,
    formats=numberformats,
    scheduler=slurm,
)</code></pre><p>Specify a limitstate function, negative value consititutes failure. Here we are interested in P(TBR &lt;= 1).</p><pre><code class="language-julia hljs">function limitstate(df)
    return reduce(vcat, df.TBR) .- 1
end</code></pre><p>Finally, we can run a Monte Carlo simulation to obtain the probability of failure.</p><pre><code class="language-julia hljs">@time pf, σ, samples = probability_of_failure(ext, limitstate, [E, R1], MonteCarlo(5000))</code></pre><p>The simulation results in <code>pf = 0.0064</code> and <code>σ = 0.001127</code> for <code>5000</code> samples. Also <code>TBR mean = 1.2404114576444423</code>, <code>TBR std = 0.10000460056126671</code>, and <code>TBR 95%: [1.0379178446904211, 1.4130216792418262]</code>.</p><p>We can also obtain the probability of failure with Subset simulation.</p><pre><code class="language-julia hljs">subset = SubSetInfinity(800, 0.1, 10, 0.5)

@time pf, std, samples = probability_of_failure(ext, limitstate, [E, R1], subset)
println(&quot;Probability of failure: $pf&quot;)</code></pre><p>This results in <code>pf = 0.0053</code> and <code>σ = 0.001133</code> for <code>2400</code> samples.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../bayesianupdating/">« Bayesian Updating</a><a class="docs-footer-nextpage" href="../../benchmarks/subset/">Subset Simulation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 17 October 2024 13:12">Thursday 17 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
